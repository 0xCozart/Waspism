{{define "ws"}}
	<script>

		let websocketProtocol = 'ws://';

		if (location.protocol === 'https:') {
			websocketProtocol = 'wss://';
		}

		const url = websocketProtocol +  location.host + '{{ uri "chainWebSocket" . }}';
		console.log('opening WebSocket to ' + url);
		const ws = new WebSocket(url);

		ws.addEventListener('error', function (event) {
			console.error('WebSocket error!', event);
		});

		const connectedAt = new Date();
		ws.addEventListener('message', function (event) {
			console.log('Message from server: ', event.data);
			ws.close();
			if (new Date() - connectedAt > 5000) {
				location.reload();
			} else {
				setTimeout(() => location.reload(), 5000);
			}
		});
	</script>
{{end}}
